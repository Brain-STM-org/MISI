---
/**
 * Main layout for the book viewer
 * Includes sidebar navigation, header, and content area
 *
 * Note: Chapter prev/next navigation is handled by the chapter page itself,
 * not the layout, to avoid duplication and allow page-specific context.
 */
import '../styles/global.css';
import Sidebar from '../components/Sidebar.astro';
import Header from '../components/Header.astro';
import { getChapter } from '../lib/chapters';

interface Props {
  title: string;
  chapterSlug?: string;
}

const { title, chapterSlug } = Astro.props;
const chapter = chapterSlug ? getChapter(chapterSlug) : undefined;
---

<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="SWE Fundamentals - A practical guide to software engineering" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>{title} | SWE Fundamentals</title>

    <!-- Initialize theme before page renders to prevent flash -->
    <script is:inline>
      const theme = localStorage.getItem('swe-book-progress');
      const settings = theme ? JSON.parse(theme).settings : {};
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const isDark = settings.theme === 'dark' || (settings.theme !== 'light' && prefersDark);
      if (isDark) document.documentElement.classList.add('dark');
    </script>
  </head>

  <body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen">
    <div class="flex min-h-screen">
      <!-- Sidebar -->
      <Sidebar currentSlug={chapterSlug} />

      <!-- Main content area -->
      <div class="flex-1 flex flex-col lg:ml-72">
        <Header title={chapter?.title || title} chapter={chapter} />

        <main class="flex-1 px-4 py-8 lg:px-8 max-w-4xl mx-auto w-full">
          <slot />
        </main>

        <!-- Footer -->
        <footer class="px-4 py-6 lg:px-8 text-center text-sm text-gray-500 dark:text-gray-400 border-t border-gray-200 dark:border-gray-800">
          <p>SWE Fundamentals &mdash; MISI Program</p>
        </footer>
      </div>
    </div>

    <!-- Initialize progress tracking -->
    <script>
      import { initProgress } from '../lib/progress';
      initProgress();
    </script>
  </body>
</html>
