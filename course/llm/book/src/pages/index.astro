---
/**
 * Homepage - Course overview and chapter listing
 */
import BookLayout from '../layouts/BookLayout.astro';
import { tableOfContents, totalReadingTime, tierDescriptions } from '../lib/chapters';
import { ReviewPrompt } from '@repo/book-viewer/components';

// URL helper for base path
const base = import.meta.env.BASE_URL || '/';
const basePath = base.endsWith('/') ? base.slice(0, -1) : base;
const url = (path: string) => `${basePath}${path}`;
---

<BookLayout title="Welcome">
  <div class="animate-fade-in">
    <!-- Hero section -->
    <div class="text-center mb-12">
      <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-4">
        LLM Fundamentals
      </h1>
      <p class="text-xl text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
        Learn to work effectively with AI coding assistants
      </p>
      <div class="mt-6 flex items-center justify-center gap-4 text-sm text-gray-500 dark:text-gray-400">
        <span>18 chapters</span>
        <span>•</span>
        <span>~{totalReadingTime} minutes total</span>
        <span>•</span>
        <span>4 tiers of content</span>
      </div>
    </div>

    <!-- Quick start -->
    <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-6 mb-12">
      <h2 class="text-lg font-semibold text-blue-900 dark:text-blue-100 mb-2">
        Getting Started
      </h2>
      <p class="text-blue-800 dark:text-blue-200 mb-4">
        This book is designed for self-paced learning with features to help you learn effectively:
      </p>
      <ul class="space-y-2 text-blue-700 dark:text-blue-300 text-sm">
        <li class="flex items-center gap-2">
          <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <span><strong>Understand AI fundamentals</strong> — Learn how LLMs work and their capabilities</span>
        </li>
        <li class="flex items-center gap-2">
          <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
          </svg>
          <span><strong>Master prompt engineering</strong> — Write effective prompts for AI assistants</span>
        </li>
        <li class="flex items-center gap-2">
          <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <span><strong>Develop AI intuition</strong> — Know when and how to leverage AI effectively</span>
        </li>
        <li class="flex items-center gap-2">
          <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <span><strong>Build with confidence</strong> — Create AI-powered applications responsibly</span>
        </li>
      </ul>
      <div class="mt-6">
        <a
          href={url('/chapters/00-what-is-machine-intelligence')}
          class="inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium"
        >
          Start Chapter 0
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
          </svg>
        </a>
      </div>
    </div>

    <!-- Review prompt (shown when concepts are due) -->
    <ReviewPrompt client:only="react" />

    <!-- Table of contents by tier -->
    <div class="space-y-8">
      {tableOfContents.tiers.map((tier) => (
        <section>
          <div class="mb-4">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">
              Tier {tier.number}: {tier.title}
            </h2>
            <p class="text-gray-600 dark:text-gray-400 mt-1">
              {tierDescriptions[tier.number]}
            </p>
          </div>
          <div class="grid gap-4 sm:grid-cols-2">
            {tier.chapters.map((chapter) => (
              <a
                href={url(`/chapters/${chapter.slug}`)}
                class="group block p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 hover:border-blue-300 dark:hover:border-blue-600 hover:shadow-md transition-all"
                data-chapter-card={chapter.slug}
              >
                <div class="flex items-start justify-between">
                  <div>
                    <span class="text-xs text-gray-400 dark:text-gray-500">
                      Chapter {chapter.number}
                    </span>
                    <h3 class="font-semibold text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">
                      {chapter.title}
                    </h3>
                  </div>
                  <span class="text-xs text-gray-400 whitespace-nowrap ml-2">
                    {chapter.estimatedMinutes} min
                  </span>
                </div>
                <div class="mt-2 flex items-center gap-2">
                  <div class="flex-1 h-1 bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden">
                    <div
                      class="h-full bg-blue-500 rounded-full transition-all duration-300"
                      data-chapter-progress={chapter.slug}
                      style="width: 0%"
                    />
                  </div>
                  <span
                    class="text-xs text-gray-400"
                    data-chapter-status={chapter.slug}
                  />
                </div>
              </a>
            ))}
          </div>
        </section>
      ))}
    </div>

    <!-- Learning tips -->
    <div class="mt-12 p-6 bg-gray-50 dark:bg-gray-800 rounded-xl">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
        Tips for Effective Learning
      </h2>
      <div class="grid gap-4 sm:grid-cols-2">
        <div>
          <h3 class="font-medium text-gray-800 dark:text-gray-200 mb-1">Experiment with Prompts</h3>
          <p class="text-sm text-gray-600 dark:text-gray-400">
            Try different phrasings and approaches. Learning to communicate with AI is a skill that improves with practice.
          </p>
        </div>
        <div>
          <h3 class="font-medium text-gray-800 dark:text-gray-200 mb-1">Verify AI Outputs</h3>
          <p class="text-sm text-gray-600 dark:text-gray-400">
            Always review and validate AI-generated content. Developing critical evaluation skills is essential.
          </p>
        </div>
        <div>
          <h3 class="font-medium text-gray-800 dark:text-gray-200 mb-1">Understand Limitations</h3>
          <p class="text-sm text-gray-600 dark:text-gray-400">
            Know what LLMs can and cannot do. This helps you use them effectively and avoid common pitfalls.
          </p>
        </div>
        <div>
          <h3 class="font-medium text-gray-800 dark:text-gray-200 mb-1">Build Iteratively</h3>
          <p class="text-sm text-gray-600 dark:text-gray-400">
            Start simple and refine. Complex AI applications are built step by step with continuous improvement.
          </p>
        </div>
      </div>
    </div>
  </div>
</BookLayout>

<script>
  import { progressStore } from '@repo/book-viewer/lib';

  // Update chapter cards with progress
  function updateChapterCards() {
    const progress = progressStore.get();

    document.querySelectorAll('[data-chapter-progress]').forEach((el) => {
      const slug = el.getAttribute('data-chapter-progress');
      if (slug) {
        const chapterProgress = progress.chapters[slug]?.readProgress || 0;
        (el as HTMLElement).style.width = `${chapterProgress}%`;
      }
    });

    document.querySelectorAll('[data-chapter-status]').forEach((el) => {
      const slug = el.getAttribute('data-chapter-status');
      if (slug) {
        const chapter = progress.chapters[slug];
        if (chapter?.completed) {
          el.textContent = '✓';
          el.classList.add('text-green-500');
        } else if (chapter?.started) {
          el.textContent = 'In progress';
        }
      }
    });
  }

  progressStore.subscribe(updateChapterCards);
  updateChapterCards();
</script>
